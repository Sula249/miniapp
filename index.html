<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- ... (остальное без изменений) ... -->
    <style>
        /* ... (предыдущие стили без изменений) ... */
        
        #inputContainer {
            z-index: 10; /* Добавлено */
            /* Остальные стили без изменений */
        }
    </style>
</head>
<body>
    <!-- ... (остальное без изменений) ... -->

    <script>
        try {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = Telegram.WebApp;
                tg.expand();

                // Инициализация темы
                const updateTheme = () => {
                    document.body.style.backgroundColor = tg.themeParams.bg_color || '#ffffff';
                    document.body.style.color = tg.themeParams.text_color || '#000000';
                };
                updateTheme();
                tg.onEvent('themeChanged', updateTheme);

                // Элементы управления
                const elements = {
                    mainButton: document.getElementById('mainButton'),
                    inputContainer: document.getElementById('inputContainer'),
                    searchInput: document.getElementById('searchInput'),
                    searchButton: document.getElementById('searchButton')
                };

                // Обработка ввода
                const processInput = () => {
                    const query = elements.searchInput.value.trim();
                    if (!query) return;
                    tg.sendData(encodeURIComponent(query));
                    elements.searchInput.value = '';
                };

                // Обработчики событий
                elements.searchInput.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') processInput();
                });

                elements.mainButton.addEventListener('click', () => {
                    const isVisible = elements.inputContainer.classList.toggle('visible');
                    tg.BackButton[isVisible ? 'show' : 'hide']();
                    elements.inputContainer.style.bottom = isVisible ? '80px' : '15px';
                    if (isVisible) setTimeout(() => elements.searchInput.focus(), 150);
                });

                elements.searchButton.addEventListener('click', processInput);

                // Обработка BackButton
                tg.BackButton.onClick(() => {
                    elements.inputContainer.classList.remove('visible');
                    elements.inputContainer.style.bottom = '15px';
                    tg.BackButton.hide();
                });

            } else {
                console.warn("Telegram WebApp API недоступен!");
            }
        } catch (error) {
            console.error("Ошибка инициализации Telegram WebApp:", error);
        }
    </script>
</body>
</html>
