<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram MiniApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script async src="https://cse.google.com/cse.js?cx=e58c2408882ae476e"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh; /* Changed from height to min-height */
            margin: 0;
            font-family: var(--tg-font-family, Arial, sans-serif);
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Rest of the styles remain the same */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0);
            transition: background-color 0.3s ease;
            pointer-events: none;
            z-index: 1;
        }
        
        /* ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... */
    </style>
</head>
<body>
    <h1 id="title">–ü–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞</h1>
    <div class="overlay"></div>
    <div class="loader"></div>

    <div id="searchContainer" class="inputContainer">
        <form id="searchForm" class="wrapper">
            <input type="text" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å" 
                   id="query" 
                   required
                   autocomplete="off"
                   aria-label="–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å">
            <button type="submit" id="searchButton" aria-label="–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫">üîé –ü–æ–∏—Å–∫</button>
        </form>
    </div>

    <div id="questionContainer" class="inputContainer">
        <div class="wrapper">
            <input type="text" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å" 
                   id="questionInput"
                   aria-label="–í–æ–ø—Ä–æ—Å" />
            <button id="questionButton" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å">üí≠ –ó–∞–¥–∞—Ç—å</button>
        </div>
    </div>

    <div class="container">
        <button id="mainButton" class="toggleButton" aria-label="–ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫">üîé –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫</button>
        <button id="toggleSearchButton" class="toggleButton hidden" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å">üí≠ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</button>
    </div>

    <div class="gcse-searchresults-only" id="results"></div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const tg = window.Telegram?.WebApp;
            if (!tg) {
                console.warn("Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!");
                return;
            }

            tg.expand();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const elements = {
                mainButton: document.getElementById("mainButton"),
                toggleSearchButton: document.getElementById("toggleSearchButton"),
                searchContainer: document.getElementById("searchContainer"),
                questionContainer: document.getElementById("questionContainer"),
                searchForm: document.getElementById("searchForm"),
                queryInput: document.getElementById("query"),
                questionInput: document.getElementById("questionInput"),
                questionButton: document.getElementById("questionButton"),
                overlay: document.querySelector(".overlay"),
                loader: document.querySelector('.loader')
            };

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            for (const [key, element] of Object.entries(elements)) {
                if (!element) {
                    console.error(`–≠–ª–µ–º–µ–Ω—Ç ${key} –Ω–µ –Ω–∞–π–¥–µ–Ω!`);
                    return;
                }
            }

            const updateTheme = () => {
                document.body.style.backgroundColor = tg.themeParams.bg_color || getComputedStyle(document.body).backgroundColor;
                document.body.style.color = tg.themeParams.text_color || getComputedStyle(document.body).color;
            };

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏
            async function logQueryToGoogleSheets(query) {
                const scriptUrl = 'https://script.google.com/macros/s/AKfycbypBtYb0Y8XiGYlEpRyzJq_yqCrE5ieiFwXT92MPsSF29EIFQLmOcp0gZZXasgQb3S9/exec';
                try {
                    const response = await fetch(scriptUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ query })
                    });
                    return response;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                    throw error;
                }
            }

            // Event listeners —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
            elements.searchForm.addEventListener("submit", async function(event) {
                event.preventDefault();
                const query = elements.queryInput.value.trim();
                if (!query) return;

                elements.loader.classList.add('visible');
                
                try {
                    await logQueryToGoogleSheets(query);
                    
                    const searchElement = document.querySelector('input.gsc-input');
                    const searchButton = document.querySelector('button.gsc-search-button');
                    
                    if (searchElement && searchButton) {
                        searchElement.value = query;
                        searchButton.click();
                    } else {
                        throw new Error('–≠–ª–µ–º–µ–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ Google –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–∏—Å–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                } finally {
                    setTimeout(() => elements.loader.classList.remove('visible'), 1000);
                    hideAll();
                }
            });

            // ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
        });
    </script>
</body>
</html>
