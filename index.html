<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- ... (все предыдущие метатеги и скрипты остаются без изменений) ... -->
    <style>
        /* Добавляем новые стили для индикатора загрузки */
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            z-index: 20;
        }

        .loader-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-top-color: var(--tg-theme-button-color, #0088cc);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Модифицируем контейнер результатов */
        .gcse-searchresults-only {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            bottom: 100px;
            overflow-y: auto;
            padding: 15px;
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            z-index: 5;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gcse-searchresults-only.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Добавляем индикатор загрузки -->
    <div class="loader">
        <div class="loader-spinner"></div>
    </div>

    <!-- ... (остальная разметка остается без изменений) ... -->

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            if (window.Telegram && window.Telegram.WebApp) {
                // ... (предыдущий код инициализации остается без изменений) ...

                // Добавляем обработчики для индикатора загрузки
                const loader = document.querySelector('.loader');
                const resultsContainer = document.getElementById('results');

                function showLoader() {
                    loader.style.display = 'block';
                    resultsContainer.classList.remove('visible');
                }

                function hideLoader() {
                    loader.style.display = 'none';
                    resultsContainer.classList.add('visible');
                }

                // Модифицируем обработчик отправки формы
                searchForm.addEventListener("submit", async function(event) {
                    event.preventDefault();
                    const query = queryInput.value.trim();
                    if (!query) return;

                    showLoader();
                    
                    try {
                        await logQueryToGoogleSheets(query);
                        
                        const searchElement = document.querySelector('input.gsc-input');
                        if (searchElement) {
                            searchElement.value = query;
                            document.querySelector('button.gsc-search-button').click();
                        }

                        // Ждем появления результатов
                        const resultsObserver = new MutationObserver((mutations) => {
                            if (document.querySelector('.gsc-results')) {
                                resultsObserver.disconnect();
                                hideLoader();
                            }
                        });
                        
                        resultsObserver.observe(resultsContainer, {
                            childList: true,
                            subtree: true
                        });

                        // Таймаут на случай ошибки загрузки
                        setTimeout(hideLoader, 5000);

                    } catch (error) {
                        console.error(error);
                        hideLoader();
                    }
                    
                    hideAll();
                });

                // ... (остальной код остается без изменений) ...
            }
        });
    </script>
</body>
</html>
