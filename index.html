<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram MiniApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
    </style>
</head>
<body>
    <h1 id="title">–ü—Ä–∏–≤–µ—Ç, Mini App!</h1>
    <div class="overlay"></div>

    <div id="searchContainer" class="inputContainer">
        <div class="wrapper">
            <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å" id="searchInput" />
            <button id="searchButton">üîé –ü–æ–∏—Å–∫</button>
        </div>
    </div>

    <div id="questionContainer" class="inputContainer">
        <div class="wrapper">
            <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å" id="questionInput" />
            <button id="questionButton">üí≠ –ó–∞–¥–∞—Ç—å</button>
        </div>
    </div>

    <div class="container">
        <button id="mainButton" class="toggleButton">üîé –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫</button>
        <button id="toggleSearchButton" class="toggleButton hidden">üí≠ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</button>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = Telegram.WebApp;
                tg.expand();

                const updateTheme = () => {
                    document.body.style.backgroundColor = tg.themeParams.bg_color || getComputedStyle(document.body).backgroundColor;
                    document.body.style.color = tg.themeParams.text_color || getComputedStyle(document.body).color;
                };

                updateTheme();
                tg.onEvent("themeChanged", updateTheme);

                const mainButton = document.getElementById("mainButton");
                const toggleSearchButton = document.getElementById("toggleSearchButton");
                const searchContainer = document.getElementById("searchContainer");
                const questionContainer = document.getElementById("questionContainer");
                const searchInput = document.getElementById("searchInput");
                const searchButton = document.getElementById("searchButton");
                const questionInput = document.getElementById("questionInput");
                const questionButton = document.getElementById("questionButton");
                const overlay = document.querySelector(".overlay");

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫
                function toggleButtons() {
                    mainButton.classList.toggle("hidden");
                    toggleSearchButton.classList.toggle("hidden");
                }

                // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏ —Å–∫—Ä—ã—Ç–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                function showSearch() {
                    searchContainer.classList.add("visible");
                    questionContainer.classList.remove("visible");
                    overlay.classList.add("visible");
                    searchInput.focus();
                    toggleButtons();
                    mainButton.classList.add("flip");
                    toggleSearchButton.classList.add("flipBack");
                    setTimeout(() => {
                        mainButton.classList.remove("flip");
                        toggleSearchButton.classList.remove("flipBack");
                    }, 600); 
                }

                function showQuestion() {
                    questionContainer.classList.add("visible");
                    searchContainer.classList.remove("visible");
                    overlay.classList.add("visible");
                    questionInput.focus();
                    toggleButtons();
                    toggleSearchButton.classList.add("flip");
                    mainButton.classList.add("flipBack");
                    setTimeout(() => {
                        toggleSearchButton.classList.remove("flip");
                        mainButton.classList.remove("flipBack");
                    }, 600); 
                }

                function hideAll() {
                    searchContainer.classList.remove("visible");
                    questionContainer.classList.remove("visible");
                    overlay.classList.remove("visible");
                }

                mainButton.addEventListener("click", showSearch);
                toggleSearchButton.addEventListener("click", showQuestion);
                overlay.addEventListener("click", hideAll);

                // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Google Sheets
                async function logSearch(query, category) {
                    const response = await fetch('YOUR_GOOGLE_SCRIPT_URL', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            keyword: query,
                            category: category,
                            date: new Date().toISOString()
                        })
                    });
                    const data = await response.json();
                    console.log("–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ", data);
                }

                // –ü–æ–∏—Å–∫
                searchButton.addEventListener("click", () => {
                    const query = searchInput.value.trim();
                    if (query) {
                        alert(`–ü–æ–∏—Å–∫: ${query}`);
                        logSearch(query, 'search');  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                    } else {
                        alert("–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞.");
                    }
                });

                // –í–æ–ø—Ä–æ—Å
                questionButton.addEventListener("click", () => {
                    const question = questionInput.value.trim();
                    if (question) {
                        alert(`–í–æ–ø—Ä–æ—Å: ${question}`);
                        logSearch(question, 'question');  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞
                    } else {
                        alert("–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å.");
                    }
                });
            } else {
                console.warn("Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!");
            }
        });
    </script>
</body>
</html>
